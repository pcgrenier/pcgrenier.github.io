<div class="highlight"><pre><span class="nd">@OnEnabled</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onConfigured</span><span class="o">(</span><span class="kd">final</span> <span class="n">ConfigurationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InitializationException</span><span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Starting properties file service&quot;</span><span class="o">);</span>
    <span class="n">configUri</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="n">CONFIG_URI</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
    <span class="n">reloadIntervalMilli</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="n">RELOAD_INTERVAL</span><span class="o">).</span><span class="na">asTimePeriod</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

    <span class="c1">// Initialize the properties</span>
    <span class="n">loadPropertiesFiles</span><span class="o">();</span>

    <span class="n">fileWatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SynchronousFileWatcher</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">configUri</span><span class="o">),</span> <span class="k">new</span> <span class="nf">LastModifiedMonitor</span><span class="o">());</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">();</span>
    <span class="n">FilesWatcherWorker</span> <span class="n">reloadTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FilesWatcherWorker</span><span class="o">();</span>
    <span class="n">executor</span><span class="o">.</span><span class="na">scheduleWithFixedDelay</span><span class="o">(</span><span class="n">reloadTask</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">reloadIntervalMilli</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>